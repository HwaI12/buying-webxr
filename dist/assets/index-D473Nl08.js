(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class c{constructor(t){this.config=t,this.entity=null}create(t){this.entity=document.createElement("a-entity");const e=Object.entries(this.config).map(([n,i])=>`${n}: ${i}`).join("; ");return this.entity.setAttribute("environment",e),t.appendChild(this.entity),this.entity}updateConfig(t,e){this.config[t]=e,this.entity&&this.entity.setAttribute("environment",t,e)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class h{constructor(t){this.id=t.id,this.modelSrc=t.modelSrc,this.position=t.position,this.rotation=t.rotation,this.scale=t.scale,this.entity=null,this.assetItem=null}createAsset(t){return this.assetItem=document.createElement("a-asset-item"),this.assetItem.setAttribute("id",`${this.id}-gltf`),this.assetItem.setAttribute("src",this.modelSrc),t.appendChild(this.assetItem),this.assetItem}create(t){return this.entity=document.createElement("a-entity"),this.entity.setAttribute("gltf-model",`#${this.id}-gltf`),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`),this.entity.setAttribute("scale",`${this.scale.x} ${this.scale.y} ${this.scale.z}`),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setRotation(t){this.rotation={...this.rotation,...t},this.entity&&this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`)}setScale(t){this.scale={...this.scale,...t},this.entity&&this.entity.setAttribute("scale",`${this.scale.x} ${this.scale.y} ${this.scale.z}`)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null),this.assetItem&&this.assetItem.parentNode&&(this.assetItem.parentNode.removeChild(this.assetItem),this.assetItem=null)}getEntity(){return this.entity}}class y{constructor(t){this.id=t.id,this.position=t.position,this.width=t.width,this.height=t.height,this.rotation=t.rotation,this.texture=t.texture,this.repeat=t.repeat||1,this.color=t.color||"#ffffff",this.entity=null}create(t){return this.entity=document.createElement("a-plane"),this.entity.setAttribute("id",this.id),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`),this.entity.setAttribute("width",this.width),this.entity.setAttribute("height",this.height),this.texture?(this.entity.setAttribute("src",this.texture),this.entity.setAttribute("material",`repeat: ${this.repeat} ${this.repeat}; transparent: false; opacity: 1; side: double`)):(this.entity.setAttribute("color",this.color),this.entity.setAttribute("material","transparent: false; opacity: 1; side: double")),this.entity.setAttribute("shadow","receive: true"),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setSize(t,e){this.width=t,this.height=e,this.entity&&(this.entity.setAttribute("width",t),this.entity.setAttribute("height",e))}setTexture(t){this.texture=t,this.entity&&this.entity.setAttribute("src",t)}setRepeat(t){this.repeat=t,this.entity&&this.entity.setAttribute("material",`repeat: ${t} ${t}`)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class u{constructor(t){this.id=t.id,this.position=t.position,this.width=t.width,this.height=t.height,this.rotation=t.rotation||{x:0,y:0,z:0},this.color=t.color||"#ffffff",this.texture=t.texture,this.repeat=t.repeat||{x:1,y:1},this.entity=null}create(t){return this.entity=document.createElement("a-plane"),this.entity.setAttribute("id",this.id),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`),this.entity.setAttribute("width",this.width),this.entity.setAttribute("height",this.height),this.texture?(this.entity.setAttribute("src",this.texture),this.entity.setAttribute("material",`repeat: ${this.repeat.x} ${this.repeat.y}; transparent: false; opacity: 1; side: double`)):(this.entity.setAttribute("color",this.color),this.entity.setAttribute("material","transparent: false; opacity: 1; side: double")),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setSize(t,e){this.width=t,this.height=e,this.entity&&(this.entity.setAttribute("width",t),this.entity.setAttribute("height",e))}setTexture(t){this.texture=t,this.entity&&this.entity.setAttribute("src",t)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class d{constructor(t){this.id=t.id,this.position=t.position,this.dimensions=t.dimensions,this.rotation=t.rotation||{x:0,y:0,z:0},this.texture=t.texture,this.repeat=t.repeat||{x:1,y:1},this.color=t.color||"#ffffff",this.entity=null}create(t){return this.entity=document.createElement("a-box"),this.entity.setAttribute("id",this.id),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`),this.entity.setAttribute("width",this.dimensions.width),this.entity.setAttribute("height",this.dimensions.height),this.entity.setAttribute("depth",this.dimensions.depth),this.texture?(this.entity.setAttribute("src",this.texture),this.entity.setAttribute("material",`repeat: ${this.repeat.x} ${this.repeat.y}; roughness: 0.8; metalness: 0.1`)):(this.entity.setAttribute("color",this.color),this.entity.setAttribute("material","roughness: 0.8; metalness: 0.1")),this.entity.setAttribute("shadow","cast: true; receive: true"),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setDimensions(t){this.dimensions={...this.dimensions,...t},this.entity&&(t.width&&this.entity.setAttribute("width",t.width),t.height&&this.entity.setAttribute("height",t.height),t.depth&&this.entity.setAttribute("depth",t.depth))}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class p{constructor(t){this.id=t.id,this.position=t.position,this.dimensions=t.dimensions,this.color=t.color||"#ffffff",this.entity=null}create(t){return this.entity=document.createElement("a-box"),this.entity.setAttribute("id",this.id),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("width",this.dimensions.width),this.entity.setAttribute("height",this.dimensions.height),this.entity.setAttribute("depth",this.dimensions.depth),this.entity.setAttribute("color",this.color),this.entity.setAttribute("material","roughness: 0.3; metalness: 0.1"),this.entity.setAttribute("shadow","cast: true; receive: true"),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setDimensions(t){this.dimensions={...this.dimensions,...t},this.entity&&(t.width&&this.entity.setAttribute("width",t.width),t.height&&this.entity.setAttribute("height",t.height),t.depth&&this.entity.setAttribute("depth",t.depth))}setColor(t){this.color=t,this.entity&&this.entity.setAttribute("color",t)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class m{constructor(t){this.type=t.type||"ambient",this.color=t.color||"#ffffff",this.intensity=t.intensity!==void 0?t.intensity:1,this.position=t.position||{x:0,y:5,z:0},this.entity=null}create(t){return this.entity=document.createElement("a-light"),this.entity.setAttribute("type",this.type),this.entity.setAttribute("color",this.color),this.entity.setAttribute("intensity",this.intensity),this.type!=="ambient"&&this.type!=="hemisphere"&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),t.appendChild(this.entity),this.entity}setIntensity(t){this.intensity=t,this.entity&&this.entity.setAttribute("intensity",t)}setColor(t){this.color=t,this.entity&&this.entity.setAttribute("color",t)}setPosition(t){this.position={...this.position,...t},this.entity&&this.type!=="ambient"&&this.type!=="hemisphere"&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null)}getEntity(){return this.entity}}class f{constructor(t){this.position=t.position,this.rotation=t.rotation||{x:0,y:0,z:0},this.wasdControlsEnabled=t.wasdControlsEnabled,this.lookControls=t.lookControls,this.cursorConfig=t.cursor,this.entity=null,this.cameraElement=null,this.cursorElement=null}create(t){this.entity=document.createElement("a-entity"),this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`),this.entity.setAttribute("rotation",`${this.rotation.x} ${this.rotation.y} ${this.rotation.z}`),this.cameraElement=document.createElement("a-camera"),this.cameraElement.setAttribute("wasd-controls-enabled",this.wasdControlsEnabled);const e=Object.entries(this.lookControls).map(([n,i])=>`${n}: ${i}`).join("; ");return this.cameraElement.setAttribute("look-controls",e),this.cursorElement=document.createElement("a-cursor"),this.cursorElement.setAttribute("color",this.cursorConfig.color),this.cursorElement.setAttribute("opacity",this.cursorConfig.opacity),this.cursorElement.setAttribute("raycaster",`objects: ${this.cursorConfig.raycasterObjects}`),this.cameraElement.appendChild(this.cursorElement),this.entity.appendChild(this.cameraElement),t.appendChild(this.entity),this.entity}setPosition(t){this.position={...this.position,...t},this.entity&&this.entity.setAttribute("position",`${this.position.x} ${this.position.y} ${this.position.z}`)}setWasdControls(t){this.wasdControlsEnabled=t,this.cameraElement&&this.cameraElement.setAttribute("wasd-controls-enabled",t)}setCursorColor(t){this.cursorConfig.color=t,this.cursorElement&&this.cursorElement.setAttribute("color",t)}remove(){this.entity&&this.entity.parentNode&&(this.entity.parentNode.removeChild(this.entity),this.entity=null,this.cameraElement=null,this.cursorElement=null)}getEntity(){return this.entity}getCameraElement(){return this.cameraElement}}class b{constructor(t){this.config=t,this.sceneElement=null,this.assetsElement=null,this.environment=null,this.showcases=[],this.objects=[],this.showcaseItems=[],this.floor=null,this.walls=[],this.thickWalls=[],this.platforms=[],this.lights=[],this.camera=null,this.layoutPatterns=null,this.selectedPattern=null,this.currentPatternIndex=0}async init(){if(this.sceneElement=document.querySelector("a-scene"),!this.sceneElement){console.error("A-Frameシーンが見つかりません");return}this.assetsElement=this.sceneElement.querySelector("a-assets"),this.assetsElement||(this.assetsElement=document.createElement("a-assets"),this.sceneElement.appendChild(this.assetsElement)),await this.loadLayoutPatterns(),this.createEnvironment(),this.createFloor(),this.createWalls(),this.createThickWalls(),this.createPlatforms(),this.createLights(),this.createShowcases(),this.createObjects(),this.createShowcaseItems(),this.createCamera()}createEnvironment(){this.environment=new c(this.config.environment),this.environment.create(this.sceneElement)}createShowcases(){this.config.showcases.forEach(t=>{const e=new h(t);e.createAsset(this.assetsElement),e.create(this.sceneElement),this.showcases.push(e)})}createObjects(){this.config.objects&&this.config.objects.forEach(t=>{const e=new h(t);e.createAsset(this.assetsElement),e.create(this.sceneElement),this.objects.push(e)})}createFloor(){this.config.floor&&(this.floor=new y(this.config.floor),this.floor.create(this.sceneElement))}createWalls(){this.config.walls&&this.config.walls.forEach(t=>{const e=new u(t);e.create(this.sceneElement),this.walls.push(e)})}createThickWalls(){this.config.thickWalls&&this.config.thickWalls.forEach(t=>{const e=new d(t);e.create(this.sceneElement),this.thickWalls.push(e)})}createPlatforms(){this.config.platforms&&this.config.platforms.forEach(t=>{const e=new p(t);e.create(this.sceneElement),this.platforms.push(e)})}createLights(){this.config.lights&&this.config.lights.forEach(t=>{const e=new m(t);e.create(this.sceneElement),this.lights.push(e)})}createCamera(){const t=this.getRandomCameraConfig();this.camera=new f(t),this.camera.create(this.sceneElement),console.log(`カメラ位置: ${t.selectedPosition.description} (${t.selectedPosition.id})`)}getRandomCameraConfig(){const t=this.config.cameraPositions,e=Math.floor(Math.random()*t.length),n=t[e];return{...this.config.camera,position:n.position,rotation:n.rotation||{x:0,y:0,z:0},selectedPosition:n}}async loadLayoutPatterns(){try{const t=await fetch("./data/showcase-layouts.json");if(!t.ok)throw new Error(`JSONファイルの読み込みに失敗: ${t.status}`);this.layoutPatterns=await t.json();const e=this.layoutPatterns.patterns;this.currentPatternIndex=Math.floor(Math.random()*e.length),this.selectedPattern=e[this.currentPatternIndex],console.log(`選択されたレイアウトパターン: ${this.selectedPattern.name} (${this.selectedPattern.id})`),console.log(`説明: ${this.selectedPattern.description}`)}catch(t){console.error("レイアウトパターンの読み込みエラー:",t),this.selectedPattern=null}}switchToNextPattern(){return!this.layoutPatterns||!this.layoutPatterns.patterns?(console.error("レイアウトパターンが読み込まれていません"),!1):(this.showcaseItems.forEach(t=>t.remove()),this.showcaseItems=[],this.currentPatternIndex=(this.currentPatternIndex+1)%this.layoutPatterns.patterns.length,this.selectedPattern=this.layoutPatterns.patterns[this.currentPatternIndex],console.log(`パターン切り替え: ${this.selectedPattern.name} (${this.selectedPattern.id})`),console.log(`説明: ${this.selectedPattern.description}`),this.createShowcaseItems(),!0)}getCurrentPatternInfo(){return this.selectedPattern?{id:this.selectedPattern.id,name:this.selectedPattern.name,description:this.selectedPattern.description,index:this.currentPatternIndex,total:this.layoutPatterns?this.layoutPatterns.patterns.length:0}:null}createShowcaseItems(){if(!this.selectedPattern){console.warn("レイアウトパターンが選択されていません");return}this.selectedPattern.showcases.forEach(t=>{t.objects.forEach(e=>{const n=new h(e);n.createAsset(this.assetsElement),n.create(this.sceneElement),this.showcaseItems.push(n)})}),console.log(`${this.showcaseItems.length}個のアイテムをショーケースに配置しました`)}getShowcase(t){return this.showcases.find(e=>e.id===t)}getFloor(){return this.floor}getCamera(){return this.camera}getEnvironment(){return this.environment}clear(){this.environment&&(this.environment.remove(),this.environment=null),this.showcases.forEach(t=>t.remove()),this.showcases=[],this.objects.forEach(t=>t.remove()),this.objects=[],this.showcaseItems.forEach(t=>t.remove()),this.showcaseItems=[],this.floor&&(this.floor.remove(),this.floor=null),this.walls.forEach(t=>t.remove()),this.walls=[],this.thickWalls.forEach(t=>t.remove()),this.thickWalls=[],this.platforms.forEach(t=>t.remove()),this.platforms=[],this.lights.forEach(t=>t.remove()),this.lights=[],this.camera&&(this.camera.remove(),this.camera=null),this.selectedPattern=null}async reset(){this.clear(),await this.init()}}const x={environment:{preset:"japan",ground:"none",skyType:"gradient",skyColor:"#87ceeb",horizonColor:"#e6e9f0",dressing:"none",fog:.3,lighting:"none",shadow:!1},showcases:[{id:"showcase-1",modelSrc:"./models/Showcase 3D Model by LitoStudio/scene.gltf",position:{x:-4.9,y:0,z:-10},rotation:{x:0,y:270,z:0},scale:{x:1.8,y:1.4,z:2}},{id:"showcase-2",modelSrc:"./models/Showcase 3D Model by LitoStudio/scene.gltf",position:{x:0,y:0,z:-10},rotation:{x:0,y:270,z:0},scale:{x:1.8,y:1.4,z:2}}],objects:[{id:"register-1",modelSrc:"./models/Canarian Cafe Cash Register/scene.gltf",position:{x:7,y:2.3,z:-8},rotation:{x:0,y:180,z:0},scale:{x:.4,y:.4,z:.4}},{id:"money-1",modelSrc:"./models/russians_money/scene.gltf",position:{x:5,y:2.3,z:-8},rotation:{x:0,y:0,z:0},scale:{x:.0015,y:.0015,z:.0015}}],lights:[{type:"ambient",color:"#ffffff",intensity:.7},{type:"directional",color:"#ffffff",intensity:.4,position:{x:5,y:10,z:5}}],walls:[{id:"back-wall",position:{x:0,y:2.5,z:-50},width:100,height:15,rotation:{x:0,y:0,z:0},texture:"./textures/wall.jpg",repeat:{x:5,y:1}},{id:"front-wall",position:{x:0,y:2.5,z:50},width:100,height:15,rotation:{x:0,y:180,z:0},texture:"./textures/wall.jpg",repeat:{x:5,y:1}},{id:"left-wall",position:{x:-50,y:2.5,z:0},width:100,height:15,rotation:{x:0,y:90,z:0},texture:"./textures/wall.jpg",repeat:{x:5,y:1}},{id:"right-wall",position:{x:50,y:2.5,z:0},width:100,height:15,rotation:{x:0,y:-90,z:0},texture:"./textures/wall.jpg",repeat:{x:5,y:1}}],thickWalls:[{id:"back-shopping-wall",position:{x:0,y:2.5,z:-13},dimensions:{width:18,height:10,depth:.3},rotation:{x:0,y:0,z:0},texture:"./textures/plaster.jpg",repeat:{x:3,y:1}},{id:"back-shopping-wall-2",position:{x:0,y:2.5,z:-20},dimensions:{width:18,height:10,depth:.3},rotation:{x:0,y:0,z:0},texture:"./textures/plaster.jpg",repeat:{x:3,y:1}},{id:"left-shopping-wall",position:{x:-9,y:2.5,z:-13},dimensions:{width:14,height:10,depth:.3},rotation:{x:0,y:90,z:0},texture:"./textures/plaster.jpg",repeat:{x:3,y:1}},{id:"right-shopping-wall",position:{x:9,y:2.5,z:-13},dimensions:{width:14,height:10,depth:.3},rotation:{x:0,y:-90,z:0},texture:"./textures/plaster.jpg",repeat:{x:3,y:1}}],platforms:[{id:"platform-1",position:{x:6,y:.3,z:-8.7},dimensions:{width:5,height:3.8,depth:3},color:"#ffffff"}],floor:{id:"custom-floor",position:{x:0,y:0,z:0},width:100,height:100,rotation:{x:-90,y:0,z:0},texture:"./textures/floor.jpg",repeat:10},cameraPositions:[{id:"position-1",description:"正面中央",position:{x:0,y:1.6,z:30},rotation:{x:0,y:0,z:0}},{id:"position-2",description:"右側",position:{x:25,y:1.6,z:-2},rotation:{x:0,y:90,z:0}},{id:"position-3",description:"左側",position:{x:-30,y:1.6,z:-2},rotation:{x:0,y:-90,z:0}}],camera:{wasdControlsEnabled:!0,lookControls:{pointerLockEnabled:!0},cursor:{color:"#ffffff",opacity:.8,raycasterObjects:".clickable"}}};function a(){const s=document.querySelector("a-scene");s.hasLoaded?l():s.addEventListener("loaded",l)}async function l(){console.log("A-Frameシーンが読み込まれました");const s=new b(x);await s.init(),window.appScene=s,w(s),console.log("アプリケーションの初期化が完了しました"),console.log("デバッグ: window.appScene でシーンにアクセスできます")}function w(s){const t=document.getElementById("current-pattern-name"),e=document.getElementById("next-pattern-btn");function n(){const i=s.getCurrentPatternInfo();i?t.textContent=`${i.name} (${i.index+1}/${i.total})`:t.textContent="読み込みエラー"}n(),e.addEventListener("click",()=>{e.disabled=!0,s.switchToNextPattern()&&n(),setTimeout(()=>{e.disabled=!1},500)}),console.log("パターン切り替えコントロールを設定しました")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a();
